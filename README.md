# Scatter
![scatter](https://user-images.githubusercontent.com/52043844/68284290-7ca01780-007d-11ea-979b-128ca7038787.png)

Custom node for the Godot game engine to randomly place props or scenes using 3D curves.
[See it in action here](https://streamable.com/sms1m)

**Scatter V2 is not backward compatible with the first version**.  
Use the tag selector to go back to older versions if needed.

## Installation
+ Clone this repository in your addons folder
+ Navigate to **Project -> Project Settings -> Plugin** and enable the **Scatter** plugin

## Getting started
Check the two scenes under **addons/scatter/demos** to get an idea of how this addon can be used.

### Scatter nodes
+ Add a **Scatter** node to you scene tree
+ Add a **ScatterItem** node as a child
  - ScatterItem has a `Item Path` parameter. It expects a path to the scene containing the mesh you want to scatter.
  - You can add multiple ScatterItem under a single Scatter node to use
    different meshes in the same area

+ Use these buttons on top of the viewport to draw a path on your scene. By default, objects will be placed inside the path.
![path_controls](https://user-images.githubusercontent.com/52043844/69886910-b19e3380-12e4-11ea-87ea-39e8d00e2701.png)
+ The `Snap to colliders` button to force the points to stay on the surface of anything with a collision shape
  - This won't work if there's is nothing to collide with
+ `Lock to plane` forces the path points on the xz plane instead of moving them in screen space.

### Modifier stack

![modifier_stack](https://user-images.githubusercontent.com/52043844/103406914-b1620e80-4b5c-11eb-8989-d868fcae00c7.png)

The biggest change with V2 is the new `Modifier stack`. You can find it in the inspector when a Scatter node is selected.
Scatter uses a pool of transforms to know where to create new items in your scene. The modifiers runs from top to
bottom, each of them affect these transforms in a specific way. Depending on which modifiers you use in which order, 
you can end up with very different results.

Each modifiers also have their own parameters you can tweak by expanding their UI using the arrow on the left.  
![parameters](https://user-images.githubusercontent.com/52043844/103406951-da829f00-4b5c-11eb-8297-cd333969199e.png)

To add a new modifier to the stack, simply press the `Add Modifier` button to bring up this popup:  
![image](https://user-images.githubusercontent.com/52043844/103151426-586e3100-477e-11eb-940a-820dd406a45d.png)

There are 3 types of modifiers:
+ **Distribute**
  - They initialize the transform pool and place them according to their own rules
  - These modifier always undo everything that happened earlier on the stack
    so **you should always start your stack with a `Distribute` modifier and only use one**

+ **Edit**
  - They take the transforms generated by the distribute modifiers and process them.

+ **Remove**
  - They remove points from the transform pool

More modifiers may be added in the future, if you can think of something useful to many people (and not highly specific
to your own needs), open a proposal in the issues tracker.

#### Distribute Modifiers

+ **Distribute Inside (Random)**
  - The 3D curve is projected on a 2D plane (XZ). Transforms are then randomly placed inside the shape created by the 3D curve.
  - `Override Global Seed`
    + If enabled, the global seed defined on the Scatter node itself will be ignore and a local seed will be used instead
  - `Custom Seed`
    + If `Override Global Seed` is enabled, this seed will be used instead.
  - `Instance Count`
    + How many items do we want to scatter in this area.

+ **Distribute Inside (Grid)**
  - Same as `Distribute Inside (Random)` except this time, points are nicely aligned along a grid. Anything outside the curve
  will be ignored
  - `X Spacing`
    + How much space between each transforms along the X axis
  - `Z Spacing`
    + How much space between each transforms along the Z axis

+ **Distribute Along Path (Random)**
  - Randomly sample points along the path to create transforms along.
  - `Override Global Seed`
    + If enabled, the global seed defined on the Scatter node itself will be ignore and a local seed will be used instead
  - `Custom Seed`
    + If `Override Global Seed` is enabled, this seed will be used instead.
  - `Instance Count`
    + How many items do we want to scatter along the path.
  - `Align to Path`
    + Rotate each transforms around the Y axis so their forward Z axis follow the path.
    + This may or may not change later to accomodate more axes.

+ **Distribute Along Path (Even)**
  - Place transforms at regular intervals along the path.
  - `Interval`
    + How much space between each transforms placed along the curve.
  - `Align to Path`
    + Rotate each transforms around the Y axis so their forward Z axis follow the path.
    + This may or may not change later to accomodate more axes.

#### Edit Modifiers

+ **Randomize Transforms**
  - Apply a different random offset to each transforms' position, rotation and scale. 
  - `Override Global Seed`
    + If enabled, the global seed defined on the Scatter node itself will be ignore and a local seed will be used instead
  - `Custom Seed`
    + If `Override Global Seed` is enabled, this seed will be used instead.
  - `Local Space`
    + The position offset will be applied in local space
  - `Position`
    + Maximum possible offset on each axis.
  - `Rotation`
    + Maximum possible rotation offset on each axis.
  - `Scale`
    + Maximum possible scale offset on each axis.

+ **Randomize Scale (Noise)**
  - Uses an Open Simplex Noise to determine how much to scale each transforms. This is useful when you want continuity in
  the random scaling (as opposed to the `Randomize Tranforms` modifier that works as an infinite frequency noise).
  - `Override Global Seed`
    + If enabled, the global seed defined on the Scatter node itself will be ignore and a local seed will be used instead
  - `Custom Seed`
    + If `Override Global Seed` is enabled, this seed will be used instead.
  - `Octave, Period, Persistance`
    + Open Simplex Noise parameters. [Check out the Godot documentation](https://docs.godotengine.org/en/stable/classes/class_opensimplexnoise.html)
    for more details about each parameters.
  - `Scale`
    + Maximum possible scale offset on each axis.

+ **Project On Floor**
  - Casts a ray from the transform current position towards the floor. If it hits a collider, the transform is moved where the
    collision happened.
  - `Ray Length`
    + How far the ray cast should go to find a collider
  - `Ray Offset`
    + Sometimes, the 3D curve may pass through (or below) a collider. This parameter makes the raycast start before it's starting
    point to account for this.
  - `Remove Points on Miss`
    + If the raycast didn't hit anything, the transform will be completely removed. If disabled, the transforms stays where it is.
  - `Align with Floor Normal`
    + Rotates the transform so it's local Y axis maches the normal of the floor where the collision happened.
  - `Invert Ray Direction'
    + Cast a ray towards the opposite direction
  - `Floor Direction`
    + Defaults to the Down axis. You can change this value if you want to project transforms side ways toward a wall for example.

#### Remove Modifiers

+ **Exclude From Path**
  - Find all the transforms inside the given 3D path (projected on the XZ plane) and deletes them.
  - `Path Name`
    + Name of the path to use for the exclusion zone. This path must be a child of the `Scatter` node.
    + It can be a `ScatterExcludePath` or even another `Scatter` node, they both inherits from a hidden `ScatterPath` class so they both work.

+ **Exclude Along Path**
  - Find all the transforms close enough to the 3D path and deletes them.
  - `Path Name`
    + Name of the path to use for the exclusion zone. This path must be a child of the `Scatter` node.
    + It can be a `ScatterExcludePath` or even another `Scatter` node, they both inherits from a hidden `ScatterPath` class so they both work.
  - `Width`
    + How far away transforms are removed.
  - `Ignore Height`
    + Projects the 3D curve and all the transform positions on the XZ plane and perform the operations in 2D space.

+ **Exclude Around Point**
  - Deletes all the transforms within a distance to a point.
  - `Radius`
    + How far away transforms are removed.

### Presets
If you're often using a specific setup of modifiers and don't want to manually add them all the time, you can create a **preset**.  
![image](https://user-images.githubusercontent.com/52043844/103406981-043bc600-4b5d-11eb-8e5b-2a85dc0b360d.png)

+ Pressing the `Save Preset` option will open a popup asking you for a name.
  - Presets are store on your filesystem so they must be a valid file name.
  - Presets are saved in `addons/scatter/presets`. If you want to share them across multiple projects, copy this folder's content.
  - If there's already a preset with the same name, the popup will ask you to confirm wether you want to override the previous one or not.  
  ![image](https://user-images.githubusercontent.com/52043844/103152732-10a1d680-478b-11eb-83b2-6dc37bd07a8d.png)
  
+ Pressing the `Load Preset` option will open a popup listing all the presets.
  - Simply click any presets to replace the current modifier stack.
  - The `default` preset is used everytime a new `Scatter` node is created. You can override it if you prefer different defaults.  
  ![image](https://user-images.githubusercontent.com/52043844/103152775-71c9aa00-478b-11eb-91e0-08815ae9ce9d.png)


## Troubleshooting

### The addon is slow when editing a curve
When updating a Scatter Path object, a 2D polygon projected on the XZ plane is also generated internally.
This polygon is used to know if a point is inside the curve or not. If this polygon resolution is too high, regenerating
it will take time. To fix fix, increase the `Bake Interval` on the Scatter node itself. (Not on the curve resource, this one
is not used). Values around 1 or 2 are usually enough, but if your path is really large, you don't need that much precision and
you can increase this value. However, if your path is really small, you can decrease this value.

### The 3D curves are modified at different places at once
[Please read this page](https://github.com/HungryProton/scatter/wiki/Warning-about-duplicating-nodes).
When you duplicate a `Scatter` node, the curve resource is duplicated automatically so this shoudn't happen.
If it does, click on the `Curve3D` resource and click on `Make Unique`. 

### Project on floor ignores my colliders
There is [a known bug in Godot](https://github.com/godotengine/godot/issues/43744) when raycasting from a tool script.
After moving the colliders of you scene, the physic world is not synced with their new position, so you have to hit
the `Rebuild` button in the inspector, under the modifier stack. Hit it once after you made modifications to your
scene.


## Licence
- This addon is published under the MIT licence.
- Most 2D and 3D assets in the demos folder are MIT, with a few exceptions. 
Refer the the LICENCE.md in the assets folder for more details.
